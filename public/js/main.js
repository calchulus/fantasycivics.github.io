!function t(e,n,a){function o(i,s){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(r)return r(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var l=n[i]={exports:{}};e[i][0].call(l.exports,function(t){var n=e[i][1][t];return o(n||t)},l,l.exports,t,e,n,a)}return n[i].exports}for(var r="function"==typeof require&&require,i=0;i<a.length;i++)o(a[i]);return o}({1:[function(t,e,n){"use strict";function a(t,e){return g.map(function(n){var a=t[n];if(a){var o=PLAYER_MAP[a],r=e[a],i=f.getScoreBreakdown(r),s=f.getScorePoints(i),c=f.getScore(s);return{playerid:a,position:n,code:w[n],name:o.name,ward:o.ward,lastMonth:c}}return{playerid:!1,position:n,code:w[n],name:"---",ward:"---",lastMonth:0}})}function o(t,e){var n=a(t,e),r=p.getRosterTable({rows:n}),s=document.querySelector("#roster-table");s.innerHTML="",s.appendChild(r),Array.from(r.querySelectorAll("button[data-playerid]")).forEach(function(n){n.addEventListener("click",function(a){var r=n.dataset.playerid,s=n.dataset.position;switch(n.dataset.action){case"fill":i("players");break;case"drop":t[s]=!1,o(y=t);break;case"view":var c=PLAYER_MAP[r],d=e[r],l=f.getScoreBreakdown(d),u=f.getScorePoints(l),h=f.getScore(u),m=p.getAlderView({playerid:r,profile:c,breakdown:l,points:u,score:h,titles:f.TITLE}),b=vex.dialog.alert({unsafeMessage:m.innerHTML,buttons:[{type:"button",text:"Close",className:"vex-dialog-button-secondary",click:function(t){b.close()}}]})}})})}function r(t,e,n){return new Promise(function(o,r){var i=p.getAddPlayerView({rows:a(t,n)}),s=vex.dialog.alert({unsafeMessage:i.innerHTML,buttons:[{type:"button",text:"Cancel",className:"vex-dialog-button-secondary",click:function(t){o(!1),s.close()}}],callback:function(t){o(!1)}});Array.from(s.contentEl.querySelectorAll("button[data-position]")).forEach(function(n){n.addEventListener("click",function(a){a.preventDefault();var r=n.dataset.position;t[r]=e,o(t),s.close()})})})}function i(t){Array.from(document.querySelectorAll(".section.is-single")).forEach(function(t){t.classList.contains("is-hidden")||t.classList.add("is-hidden")}),document.querySelector('[data-section="'+t+'"]').classList.remove("is-hidden"),Array.from(document.querySelector("#tabs-main").children).forEach(function(t){t.classList.contains("is-active")&&t.classList.remove("is-active")}),document.querySelector('[data-tab="'+t+'"]').classList.add("is-active")}function s(t){return JSON.parse(JSON.stringify(t))}var c=t("./views"),d=t("./scoring"),l={apiKey:"AIzaSyDusGUpsFfhJmRnmB2cgfetwR3ZR2otqe4",authDomain:"fantasycivics.firebaseapp.com",databaseURL:"https://fantasycivics.firebaseio.com",storageBucket:"fantasycivics.appspot.com",messagingSenderId:"245596715039"},u=firebase.initializeApp(l,"Fantasy Civics Game").database(),p=(0,c.Views)(),f=(0,d.Scoring)(),h=new Date("8/1/2017"),m=h.getUTCMonth()-1,b=[new Date(h.getUTCFullYear(),m).getTime(),new Date(h.getUTCFullYear(),h.getUTCMonth()).getTime()];console.log(b);var v=function(t){t=t.split("+").join(" ");for(var e,n={},a=/[?&]?([^=]+)=([^&]*)/g;e=a.exec(t);)n[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return n}(document.location.search);v.tab&&i(v.tab);var y={captain:!1,council1:!1,council2:!1,graffiti:!1,rodents:!1};Array.from(document.querySelector("#tabs-main").children).forEach(function(t){t.addEventListener("click",function(e){i(t.dataset.tab)})}),u.ref("player_scores").orderByChild("timestamp").startAt(b[0]).endAt(b[1]).once("value",function(t){var e=t.val()||{},n=Object.keys(e).map(function(t){var n=e[t];return n.key=t,n}),a={};n.forEach(function(t){var e=t.playerid;a[e]=t}),console.log(a),i("roster"),o(y,a);var c=n.sort(function(t,e){return 0}).map(function(t){var e=PLAYER_MAP[t.playerid],n=f.getScoreBreakdown(t),a=f.getScorePoints(n),o=f.getScore(a);return{playerid:t.playerid,name:e.name,ward:e.ward,lastMonth:o}}),d=p.getAldersTable({rows:c}),l=document.querySelector("#alders-table");l.innerHTML="",l.appendChild(d),Sortable.initTable(d),Array.from(d.querySelectorAll("button[data-playerid]")).forEach(function(t){t.addEventListener("click",function(e){var n=t.dataset.playerid,c=PLAYER_MAP[n],d=a[n],l=f.getScoreBreakdown(d),u=f.getScorePoints(l),h=f.getScore(u),m=p.getAlderView({playerid:n,profile:c,breakdown:l,points:u,score:h,titles:f.TITLE}),b=vex.dialog.alert({unsafeMessage:m.innerHTML,buttons:[{type:"button",text:"Add To Roster",className:"vex-dialog-button-primary",click:function(t){r(s(y),n,a).then(function(t){t&&(o(y=t,a),i("roster"))}).catch(console.error),b.close()}},{type:"button",text:"Cancel",className:"vex-dialog-button-secondary",click:function(t){b.close()}}]})})}),o(y,a)});var g=["captain","council1","council2","graffiti","rodents"],w={captain:"CPTN",council1:"CNCL",council2:"CNCL",graffiti:"GRAF",rodents:"RDNT"}},{"./scoring":2,"./views":3}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Scoring=function(){var t=["graffiti","pot_holes","rodent_baiting"],e={absent:-1,contrarian:10,win:1,lose:-1,pass:7,fail:-14,complete:1,incomplete:-1};return{DATASETS_311:t,WEIGHT:e,TITLE:{absent:"Absent",contrarian:"Vote Against Mayor",win:"Won Vote",lose:"Lost Vote",pass:"Passed Bill",fail:"Failed Bill",complete:"Complete 311",incomplete:"Incomplete 311"},getScoreBreakdown:function(e){var n={absent:0,contrarian:0,win:0,lose:0,pass:0,fail:0,complete:0,incomplete:0};return t.forEach(function(t){var a=e["complete_"+t],o=e["incomplete_"+t];n.complete+=a,n.incomplete+=o}),n.absent=e.votes_absent,n.contrarian=e.votes_no_mayor,n.win=e.votes_yes_pass+e.votes_no_fail,n.lose=e.votes_yes_fail+e.votes_no_pass,n.pass=e.sponsor_pass,n.fail=e.sponsor_fail,n},getScorePoints:function(t){var n={};for(var a in t){var o=t[a];n[a]=o*e[a]}return n},getScore:function(t){var e=0;for(var n in t)e+=t[n];return e}}}},{}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Views=function(){return{getAldersTable:function(t){var e="\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Ward</th>\n\t\t\t\t\t\t<th>Score</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t";t.rows.forEach(function(t){e+='\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<span class="is-inline-img">\n\t\t\t\t\t\t\t\t<figure class="image is-32x32 headshot-holder is-rounded">\n\t\t\t\t\t\t\t\t\t<img class="headshot-img" src="../public/img/headshots/'+t.playerid+'.png" alt="'+t.name+'">\n\t\t\t\t\t\t\t\t</figure>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span>'+t.name+"</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>"+t.ward+"</td>\n\t\t\t\t\t\t<td>"+t.lastMonth+'</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button data-playerid="'+t.playerid+'" class="button is-primary is-outlined">View</button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t'}),e+="\n\t\t\t\t</tbody>\n\t\t\t";var n=document.createElement("table");return n.innerHTML=e,n.classList.add("table"),n.classList.add("sortable-theme-bootstrap"),n.setAttribute("data-sortable",!0),n},getAlderView:function(t){var e='\n\t\t\t\t<div class="media">\n\t\t\t\t\t<div class="media-left">\n\t\t\t\t\t\t<figure class="image is-48x48 headshot-holder">\n\t\t\t\t\t\t\t<img class="headshot-img" src="../public/img/headshots/'+t.playerid+'.png" alt="'+t.profile.name+'">\n\t\t\t\t\t\t</figure>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="media-content">\n\t\t\t\t\t\t<p class="title is-4">'+t.profile.name+'</p>\n\t\t\t\t\t\t<p class="subtitle is-6">Ward '+t.profile.ward+'</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<table class="table is-fullwidth">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Category</th>\n\t\t\t\t\t\t\t<th>Points</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t';for(var n in t.points){var a=t.points[n];e+="\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>"+t.titles[n]+"</td>\n\t\t\t\t\t\t<td>"+(a>0?"+":"")+a+"</td>\n\t\t\t\t\t</tr>\n\t\t\t\t"}e+="\n\t\t\t\t<tr>\n\t\t\t\t\t<th>Total</th>\n\t\t\t\t\t<th>"+t.score+"</th>\n\t\t\t\t</tr>\n\t\t\t",e+="\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t";var o=document.createElement("div");return o.innerHTML=e,o},getRosterTable:function(t){var e="\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Position</th>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Ward</th>\n\t\t\t\t\t\t<th>Score</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t";t.rows.forEach(function(t){e+="\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>"+t.code+"</td>\n\t\t\t\t\t\t<td>"+t.name+"</td>\n\t\t\t\t\t\t<td>"+t.ward+"</td>\n\t\t\t\t\t\t<td>"+t.lastMonth+"</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t",t.playerid?e+='\n\t\t\t\t\t\t<button data-playerid="'+t.playerid+'" data-action="view" data-position="'+t.position+'" class="button is-primary is-outlined">View</button>\n\t\t\t\t\t\t<button data-playerid="'+t.playerid+'" data-action="drop" data-position="'+t.position+'" class="button is-danger is-outlined">Drop</button>\n\t\t\t\t\t':e+='\n\t\t\t\t\t\t<button data-playerid="'+t.playerid+'" data-action="fill" data-position="'+t.position+'" class="button is-primary is-outlined">Fill</button>\n\t\t\t\t\t',e+="\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t"}),e+="\n\t\t\t\t</tbody>\n\t\t\t";var n=document.createElement("table");return n.innerHTML=e,n.classList.add("table"),n.classList.add("is-fullwidth"),n},getAddPlayerView:function(t){var e="\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Position</th>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Ward</th>\n\t\t\t\t\t\t<th>Score</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t";t.rows.forEach(function(t){e+="\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>"+t.code+"</td>\n\t\t\t\t\t\t<td>"+t.name+"</td>\n\t\t\t\t\t\t<td>"+t.ward+"</td>\n\t\t\t\t\t\t<td>"+t.lastMonth+'</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button data-position="'+t.position+'" class="button is-primary is-outlined">'+(t.playerid?"Replace":"Add")+"</button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t"}),e+="\n\t\t\t\t</tbody>\n\t\t\t";var n=document.createElement("table");n.innerHTML=e,n.classList.add("table"),n.classList.add("is-fullwidth");var a=document.createElement("div");return a.appendChild(n),a}}}},{}]},{},[1]);
//# sourceMappingURL=maps/main.js.map
