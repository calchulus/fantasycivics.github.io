!function t(e,n,a){function i(o,s){if(!n[o]){if(!e[o]){var c="function"==typeof require&&require;if(!s&&c)return c(o,!0);if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var d=n[o]={exports:{}};e[o][0].call(d.exports,function(t){var n=e[o][1][t];return i(n||t)},d,d.exports,t,e,n,a)}return n[o].exports}for(var r="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(t,e,n){"use strict";function a(t,e){return _.map(function(n){var a=t[n];if(a){var i=PLAYER_MAP[a],r=e[a],o=m.getScoreBreakdown(r),s=m.getScorePoints(o,n),c=m.getScore(s);return{playerid:a,position:n,code:w[n],name:i.name,ward:i.ward,lastMonth:c}}return{playerid:!1,position:n,code:w[n],name:"---",ward:"---",lastMonth:0}})}function i(t,e){var n=a(t,e),r=n.reduce(function(t,e){return t+e.lastMonth},0),c=f.getRosterTable({rows:n,total:r}),l=document.querySelector("#roster-table");l.innerHTML="",l.appendChild(c),Array.from(c.querySelectorAll("button[data-playerid]")).forEach(function(n){n.addEventListener("click",function(a){var r=n.dataset.playerid,c=n.dataset.position;switch(n.dataset.action){case"fill":s("players");break;case"drop":t[c]=!1,i(y=t);break;case"view":var l=PLAYER_MAP[r],d=e[r],u=m.getScoreBreakdown(d),p=m.getScorePoints(u,c),g=m.getScore(p),h=f.getAlderView({playerid:r,profile:l,breakdown:u,points:p,score:g,titles:m.TITLE,isFreeAgent:o(y,r)}),b=vex.dialog.alert({unsafeMessage:h.innerHTML,buttons:[{type:"button",text:"Close",className:"vex-dialog-button-secondary",click:function(t){b.close()}}]})}})})}function r(t,e,n){return new Promise(function(i,r){var o=f.getAddPlayerView({rows:a(t,n)}),s=vex.dialog.alert({unsafeMessage:o.innerHTML,buttons:[{type:"button",text:"Cancel",className:"vex-dialog-button-secondary",click:function(t){i(!1),s.close()}}],callback:function(t){i(!1)}});Array.from(s.contentEl.querySelectorAll("button[data-position]")).forEach(function(n){n.addEventListener("click",function(a){a.preventDefault();var r=n.dataset.position;t[r]=e,i(t),s.close()})})})}function o(t,e){var n=!1;for(var a in t)t[a]===e&&(n=!0);return!n}function s(t){Array.from(document.querySelectorAll(".section.is-single")).forEach(function(t){t.classList.contains("is-hidden")||t.classList.add("is-hidden")}),document.querySelector('[data-section="'+t+'"]').classList.remove("is-hidden"),Array.from(document.querySelector("#tabs-main").children).forEach(function(t){t.classList.contains("is-active")&&t.classList.remove("is-active")}),document.querySelector('[data-tab="'+t+'"]').classList.add("is-active")}function c(t){return JSON.parse(JSON.stringify(t))}var l=t("./views"),d=t("./scoring"),u={apiKey:"AIzaSyDusGUpsFfhJmRnmB2cgfetwR3ZR2otqe4",authDomain:"fantasycivics.firebaseapp.com",databaseURL:"https://fantasycivics.firebaseio.com",storageBucket:"fantasycivics.appspot.com",messagingSenderId:"245596715039"},p=firebase.initializeApp(u,"Fantasy Civics Game").database(),f=(0,l.Views)(),m=(0,d.Scoring)(),g=new Date("8/1/2017"),h=g.getUTCMonth()-1,b=[new Date(g.getUTCFullYear(),h).getTime(),new Date(g.getUTCFullYear(),g.getUTCMonth()).getTime()];console.log(b);var v=function(t){t=t.split("+").join(" ");for(var e,n={},a=/[?&]?([^=]+)=([^&]*)/g;e=a.exec(t);)n[decodeURIComponent(e[1])]=decodeURIComponent(e[2]);return n}(document.location.search);v.tab&&s(v.tab);var y={captain:!1,council1:!1,council2:!1,graffiti:!1,rodents:!1};Array.from(document.querySelector("#tabs-main").children).forEach(function(t){t.addEventListener("click",function(e){s(t.dataset.tab)})}),p.ref("player_scores").orderByChild("timestamp").startAt(b[0]).endAt(b[1]).once("value",function(t){var e=t.val()||{},n=Object.keys(e).map(function(t){var n=e[t];return n.key=t,n}),a={};n.forEach(function(t){var e=t.playerid;a[e]=t}),console.log(a),s("roster"),i(y,a);var l=n.sort(function(t,e){return 0}).map(function(t){var e=PLAYER_MAP[t.playerid],n=m.getScoreBreakdown(t),a=m.getScorePoints(n),i=m.getScore(a);return{playerid:t.playerid,name:e.name,ward:e.ward,lastMonth:i}}),d=f.getAldersTable({rows:l}),u=document.querySelector("#alders-table");u.innerHTML="",u.appendChild(d),Sortable.initTable(d),Array.from(d.querySelectorAll("button[data-playerid]")).forEach(function(t){t.addEventListener("click",function(e){var n=t.dataset.playerid,l=PLAYER_MAP[n],d=o(y,n),u=a[n],p=m.getScoreBreakdown(u),g=m.getScorePoints(p),h=m.getScore(g),b=f.getAlderView({playerid:n,profile:l,breakdown:p,points:g,score:h,titles:m.TITLE,isFreeAgent:d}),v=[];d&&v.push({type:"button",text:"Add To Roster",className:"vex-dialog-button-primary",click:function(t){r(c(y),n,a).then(function(t){t&&(i(y=t,a),s("roster"))}).catch(console.error),_.close()}}),v.push({type:"button",text:"Cancel",className:"vex-dialog-button-secondary",click:function(t){_.close()}});var _=vex.dialog.alert({unsafeMessage:b.innerHTML,buttons:v})})}),i(y,a)});var _=["captain","council1","council2","graffiti","rodents"],w={captain:"CPTN",council1:"CNCL",council2:"CNCL",graffiti:"GRAF",rodents:"RDNT"}},{"./scoring":2,"./views":3}],2:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Scoring=function(){var t=["graffiti","rodent_baiting"],e={absent:-1,contrarian:10,win:1,lose:-1,pass:7,fail:-14,complete_graffiti:1,incomplete_graffiti:-1,complete_rodent_baiting:1,incomplete_rodent_baiting:-1},n={captain:["absent","contrarian","win","lose","pass","fail","complete_graffiti","incomplete_graffiti","complete_rodent_baiting","incomplete_rodent_baiting"],council1:["absent","contrarian","win","lose","pass","fail"],council2:["absent","contrarian","win","lose","pass","fail"],graffiti:["complete_graffiti","incomplete_graffiti"],rodents:["complete_rodent_baiting","incomplete_rodent_baiting"]};return{DATASETS_311:t,WEIGHT:e,TITLE:{absent:"Absent",contrarian:"Vote Against Mayor",win:"Won Vote",lose:"Lost Vote",pass:"Passed Bill",fail:"Failed Bill",complete_graffiti:"Complete Graffiti Abatement",incomplete_graffiti:"Incomplete Graffiti Abatement",complete_rodent_baiting:"Complete Rodent Baiting",incomplete_rodent_baiting:"Incomplete Rodent Baiting"},getScoreBreakdown:function(e){var n={absent:0,contrarian:0,win:0,lose:0,pass:0,fail:0,complete_graffiti:0,incomplete_graffiti:0,complete_rodent_baiting:0,incomplete_rodent_baiting:0};return t.forEach(function(t){var a=e["complete_"+t],i=e["incomplete_"+t];n["complete_"+t]+=a,n["incomplete_"+t]+=i}),n.absent=e.votes_absent,n.contrarian=e.votes_no_mayor,n.win=e.votes_yes_pass+e.votes_no_fail,n.lose=e.votes_yes_fail+e.votes_no_pass,n.pass=e.sponsor_pass,n.fail=e.sponsor_fail,n},getScorePoints:function(t,a){var i=n[a]||[],r={};for(var o in t){var s=t[o];(i.indexOf(o)>-1||!a)&&(r[o]=s*e[o])}return r},getScore:function(t){var e=0;for(var n in t)e+=t[n];return e}}}},{}],3:[function(t,e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.Views=function(){return{getAldersTable:function(t){var e="\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Player</th>\n\t\t\t\t\t\t<th>Ward</th>\n\t\t\t\t\t\t<th>Score</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t";t.rows.forEach(function(t){e+='\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<span class="is-inline-img">\n\t\t\t\t\t\t\t\t<figure class="image is-32x32 headshot-holder is-rounded">\n\t\t\t\t\t\t\t\t\t<img class="headshot-img" src="../public/img/headshots/'+t.playerid+'.png" alt="'+t.name+'">\n\t\t\t\t\t\t\t\t</figure>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span>'+t.name+"</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>"+t.ward+"</td>\n\t\t\t\t\t\t<td>"+t.lastMonth+'</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button data-playerid="'+t.playerid+'" class="button is-primary is-outlined">View</button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t'}),e+="\n\t\t\t\t</tbody>\n\t\t\t";var n=document.createElement("table");return n.innerHTML=e,n.classList.add("table"),n.classList.add("sortable-theme-bootstrap"),n.setAttribute("data-sortable",!0),n},getAlderView:function(t){var e='\n\t\t\t\t<div class="media">\n\t\t\t\t\t<div class="media-left">\n\t\t\t\t\t\t<figure class="image is-64x64 headshot-holder">\n\t\t\t\t\t\t\t<img class="headshot-img" src="../public/img/headshots/'+t.playerid+'.png" alt="'+t.profile.name+'">\n\t\t\t\t\t\t</figure>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="media-content">\n\t\t\t\t\t\t<p class="title is-4">'+t.profile.name+'</p>\n\t\t\t\t\t\t<p class="subtitle is-6 tags">\n\t\t\t\t\t\t\t<span class="tag">Ward '+t.profile.ward+'</span>\n\t\t\t\t\t\t\t<span class="tag '+(t.isFreeAgent?"is-success":"is-warning")+'">'+(t.isFreeAgent?"Free Agent":"On Your Roster")+'</span>\n\t\t\t\t\t\t</p>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<table class="table is-fullwidth">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Category</th>\n\t\t\t\t\t\t\t<th>Points</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody>\n\t\t\t';for(var n in t.points){var a=t.points[n];e+="\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>"+t.titles[n]+"</td>\n\t\t\t\t\t\t<td>"+(a>0?"+":"")+a+"</td>\n\t\t\t\t\t</tr>\n\t\t\t\t"}e+="\n\t\t\t\t<tr>\n\t\t\t\t\t<th>Total</th>\n\t\t\t\t\t<th>"+t.score+"</th>\n\t\t\t\t</tr>\n\t\t\t",e+="\n\t\t\t\t\t</tbody>\n\t\t\t\t</table>\n\t\t\t";var i=document.createElement("div");return i.innerHTML=e,i},getRosterTable:function(t){var e="\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Position</th>\n\t\t\t\t\t\t<th>Player</th>\n\t\t\t\t\t\t<th>Ward</th>\n\t\t\t\t\t\t<th>Score</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t";t.rows.forEach(function(t){e+="\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>"+t.code+'</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<span class="is-inline-img">\n\t\t\t\t\t\t\t\t<figure class="image is-32x32 headshot-holder is-rounded">\n\t\t\t\t\t\t\t\t\t<img class="headshot-img" src="../public/img/headshots/'+(t.playerid||"no-user")+'.png" alt="'+t.name+'">\n\t\t\t\t\t\t\t\t</figure>\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<span>'+t.name+"</span>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>"+t.ward+"</td>\n\t\t\t\t\t\t<td>"+t.lastMonth+"</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t",t.playerid?e+='\n\t\t\t\t\t\t<button data-playerid="'+t.playerid+'" data-action="view" data-position="'+t.position+'" class="button is-primary is-outlined">View</button>\n\t\t\t\t\t\t<button data-playerid="'+t.playerid+'" data-action="drop" data-position="'+t.position+'" class="button is-danger is-outlined">Drop</button>\n\t\t\t\t\t':e+='\n\t\t\t\t\t\t<button data-playerid="'+t.playerid+'" data-action="fill" data-position="'+t.position+'" class="button is-primary is-outlined">Fill</button>\n\t\t\t\t\t',e+="\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t"}),e+="\n\t\t\t\t</tbody>\n\t\t\t";var n=document.createElement("table");n.innerHTML=e,n.classList.add("table"),n.classList.add("is-fullwidth");var a='\n\t\t\t\t<tbody>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<h3 class="title tag is-transparent">Total Score</h3>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<h3 class="title tag is-primary">'+t.total+"</h3>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t</tbody>\n\t\t\t",i=document.createElement("table");i.innerHTML=a,i.classList.add("table"),i.classList.add("is-narrow");var r=document.createElement("div");return r.appendChild(n),r.appendChild(i),r},getAddPlayerView:function(t){var e="\n\t\t\t\t<thead>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<th>Position</th>\n\t\t\t\t\t\t<th>Name</th>\n\t\t\t\t\t\t<th>Ward</th>\n\t\t\t\t\t\t<th>Score</th>\n\t\t\t\t\t\t<th>Actions</th>\n\t\t\t\t\t</tr>\n\t\t\t\t</thead>\n\t\t\t\t<tbody>\n\t\t\t";t.rows.forEach(function(t){e+="\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>"+t.code+"</td>\n\t\t\t\t\t\t<td>"+t.name+"</td>\n\t\t\t\t\t\t<td>"+t.ward+"</td>\n\t\t\t\t\t\t<td>"+t.lastMonth+'</td>\n\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t<button data-position="'+t.position+'" class="button is-primary is-outlined">'+(t.playerid?"Replace":"Add")+"</button>\n\t\t\t\t\t\t</td>\n\t\t\t\t\t</tr>\n\t\t\t\t"}),e+="\n\t\t\t\t</tbody>\n\t\t\t";var n=document.createElement("table");n.innerHTML=e,n.classList.add("table"),n.classList.add("is-fullwidth");var a=document.createElement("div");return a.appendChild(n),a}}}},{}]},{},[1]);
//# sourceMappingURL=maps/main.js.map
